{"mappings":"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","sources":["src/assets/js/write.js"],"sourcesContent":["\nconst tmpl = `List\n====\n\n## Quick Links\n- [home](#)\n- [preferences](#preferences)\n- [profile](#profile)\n- [sample](#sample)\n- [GitHub](https://git.io/mak)\n- [Sync a Gist](?gist=0632fe0546632d95c8d965b48ff47b15)\n\n## Gists\n* [mak_demo_modes.md](#30c93213bf556dc671f9df983a932b2a) edited 1 week ago\n* [mak_demo_tasks.md](#cdd1eaee2b55948a99d235cdc8b7596c) edited 1 week ago\n* [mak_demo_files.md](#d08a64051477ab2edaef30405368a00d) edited 1 week ago\n\n## Gists\n1. 测试有序列表\n\n## Local\n- Nothing here. Use go:filename or [](#filename) to create a new file.\n- ![](https://raw.githubusercontent.com/23784148/posts/assets/1497fb7e-bda7-44a4-86db-d0a20693ee60.png)`\n\nclass Request {\n\n    get endpoint() {\n        return 'https://isslog-server-production.up.railway.app';\n    }\n\n    async fetcher( method, params ) {\n        return await fetch( this.endpoint + method, params );\n    }\n\n    async upload( file ) {\n        const formData = new FormData();\n        formData.append( 'image', file );\n        try {\n            const response = await this.fetcher( '/api/upload', { method: 'POST', body: formData });\n            return await response.json();\n        } catch ( error ) {\n            return new Promise(( resolve, reject ) => reject( error ));\n        }\n    }\n\n    async memo( id, content ) {\n        try {\n            const response = await this.fetcher( '/api/memo', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id, content })});\n            return await response.json();\n        } catch ( error ) {\n            return new Promise(( resolve, reject ) => reject( error ));\n        }\n    }\n\n}\n\nclass Write {\n\n    get root() {\n        return '#editor';\n    }\n\n    get $root() {\n        return $( this.root );\n    }\n\n    get $toolbar() {\n        return $( '.toolbar' );\n    }\n\n    constructor() {\n        this.editor = undefined;\n        this.$root.val( tmpl );\n        this.render();\n    }\n\n    getDoc() {\n        return this.editor.getDoc();\n    }\n\n    getCurrent() {\n        const doc    = this.getDoc(),\n              cursor = doc.getCursor();\n        return { doc, cursor };\n    }\n\n    render() {\n        this.codeMirrorRender()\n            .codeMirrorListen()\n            .toolbarRender()\n            .toolbarListen();\n    }\n\n    codeMirrorRender() {\n        this.editor = CodeMirror.fromTextArea( $( this.root )[0], {\n            lineNumbers: true,\n            theme: 'neo',\n            mode: 'markdown',\n        });\n        $( '.CodeMirror' ).addClass( 'light' );\n        return this;\n    }\n\n    codeMirrorListen() {\n\n        this.editor.on( 'beforeChange', ( cm, change ) => {\n            const doc    = this.getDoc();\n            this.prevStr = doc.getLine( change.from.line );\n        });\n\n        this.editor.on( 'keyup', ( cm, event ) => {\n            if ( event.keyCode === 13 ) {\n                console.log( 'Enter key released', this.prevStr );\n                const reg = /^(-|\\*|\\d+.) /i;\n                if ( reg.test( this.prevStr )) {\n                    let flag = this.prevStr.match( reg )[0];\n                    if ( /\\d/.test( parseInt( flag )) ) {\n                        flag = ( parseInt( flag ) + 1 ) + '. ';\n                    }\n                    const { doc, cursor } = this.getCurrent();\n                    doc.replaceRange( flag, cursor );\n                }\n            }\n        });\n\n        this.editor.on( 'change', ( cm, change ) => {\n            const text = change.text.join( '' );\n            if ( [ '[', '(' ].includes( text )) {\n                const { doc, cursor } = this.getCurrent();\n                let value = text == '[' ? ']' : text == '(' ? ')' : '';\n                doc.replaceRange( value, cursor )\n                doc.setCursor( cursor.line, cursor.ch );\n            }\n        });\n\n        return this;\n    }\n\n    toolbarRender() {\n        const tmpl = `<a class=\"upload\">\n                        <svg viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\"><path d=\"M256 298.666667a85.333333 85.333333 0 1 1 85.333333 85.333333 85.333333 85.333333 0 0 1-85.333333-85.333333z m674.133333 415.146666l-256-341.333333a32.426667 32.426667 0 0 0-51.2 0l-170.666666 220.586667a21.333333 21.333333 0 0 1-33.28 0l-93.44-113.493334a32 32 0 0 0-49.92 0l-181.333334 234.24a42.666667 42.666667 0 0 0-8.96 26.026667v38.826667a32.426667 32.426667 0 0 0 32 32h789.333334a32.426667 32.426667 0 0 0 32-32v-39.253334a42.666667 42.666667 0 0 0-8.533334-25.6z\" p-id=\"5528\" fill=\"#424242\"></path></svg>\n                      </a>\n                      <a class=\"preview\">\n                        <svg viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\"><path d=\"M955.733333 497.066667c-81.066667-164.266667-249.6-277.333333-443.733333-277.333334s-362.666667 113.066667-443.733333 277.333334c-4.266667 10.666667-4.266667 21.333333 0 32 81.066667 164.266667 249.6 277.333333 443.733333 277.333333s362.666667-113.066667 443.733333-277.333333c4.266667-10.666667 4.266667-21.333333 0-32zM512 701.866667c-104.533333 0-189.866667-83.2-189.866667-189.866667s83.2-189.866667 189.866667-189.866667 189.866667 83.2 189.866667 189.866667-85.333333 189.866667-189.866667 189.866667z m0-309.333334c-66.133333 0-119.466667 53.333333-119.466667 119.466667s53.333333 119.466667 119.466667 119.466667 119.466667-53.333333 119.466667-119.466667-53.333333-119.466667-119.466667-119.466667z\" p-id=\"4273\" fill=\"#424242\"></path></svg>\n                      </a>\n                      <a class=\"submit\">\n                        <svg viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\"><path d=\"M796.2 466.4c0-2.4 0.4-4.8 0.4-7.2 0-130-103.6-235.2-231.4-235.2-92.2 0-171.4 54.8-208.6 134-16.2-8.2-34.4-13-53.6-13-59 0-108.2 43.8-117.6 101C114.6 470.4 64 538.2 64 618c0 100.4 80.2 182 179 182L448 800l0-160-96.4 0 160.4-167.4 160.4 167.2-96.4 0 0 160 220.6 0c90.4 0 163.4-75 163.4-166.8C960 541.2 886.6 466.6 796.2 466.4z\" p-id=\"2361\" fill=\"#424242\"></path></svg>\n                      </a>`;\n        this.$toolbar.html( tmpl );\n\n        return this;\n    }\n\n    toolbarListen() {\n        $( '.upload' ).on( 'click', event => {\n            const input  = document.createElement( 'input' ),\n                  $input = $( input );\n            $input.attr({ type : 'file' })\n                .one( 'change', async event => {\n                    const file = event.target.files[0];\n                    if ( file ) {\n                        const request = new Request(),\n                              result  = await request.upload( file );\n                        if ( result.code == 201 ) {\n                            const { doc, cursor } = this.getCurrent(),\n                                  image  = `![](${ result.result.url })`;\n                            doc.replaceRange( image, cursor );\n                            doc.setCursor( cursor.line, cursor.ch + image.length );\n                            this.editor.focus();\n                        } else {\n                            // TO-DO\n                        }\n                    }\n                });\n            $input.trigger( 'click' );\n        });\n    \n        $( '.preview' ).on( 'click', event => {\n            const doc    = this.getDoc(),\n                  conver = new showdown.Converter(),\n                  html   = conver.makeHtml( doc.getValue() );\n            this.previewRender( html );\n        });\n    \n        $( '.submit' ).on( 'click', async event => {\n            const doc     = this.getDoc(),\n                  request = new Request(),\n                  result  = await request.memo( 34, doc.getValue() );\n            console.log( 'asdasdf', result )\n        });\n\n        return this;\n    }\n\n    previewRender( content ) {\n        const tmpl = `<div id=\"preview\" class=\"markdown-body\">\n                        ${ content }\n                        <div class=\"close\">\n                            <svg viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"22\" height=\"22\"><path d=\"M512 992A480.512 480.512 0 0 1 32 512 480.512 480.512 0 0 1 512 32a480.512 480.512 0 0 1 480 480 480.512 480.512 0 0 1-480 480z m0-434.624l135.68 135.68a32 32 0 0 0 22.72 9.344 32 32 0 0 0 22.528-9.344 32 32 0 0 0 9.344-22.592 32 32 0 0 0-9.344-22.656L557.184 511.936l135.744-135.68a32 32 0 0 0 9.472-22.784 31.488 31.488 0 0 0-9.472-22.464 31.552 31.552 0 0 0-22.656-9.472 31.552 31.552 0 0 0-22.656 9.472L511.936 466.88 376.064 331.008a31.552 31.552 0 0 0-22.656-9.472 31.488 31.488 0 0 0-22.592 9.472 32 32 0 0 0 0 45.248l135.872 135.68-135.872 135.872a31.168 31.168 0 0 0-9.344 22.464 31.616 31.616 0 0 0 9.344 22.72 32 32 0 0 0 22.656 9.344A32 32 0 0 0 376 692.992l135.872-135.68z\" fill=\"#333333\"></path></svg>\n                        </div>\n                      </div>`;\n        $( 'body' ).append( tmpl );\n        const $target = $( '#preview' );\n        $target.find( '.close' ).on( 'click', event => {\n            $target.addClass( 'hide' ).on( \"animationend\", event => {\n                $target.remove();\n            });\n        });\n    }\n}\n\n$( document ).ready(() => {\n    new Write();\n});"],"names":["Request","endpoint","async","method","params","fetch","this","file","formData","FormData","append","response","fetcher","body","json","error","Promise","resolve","reject","id","content","headers","JSON","stringify","Write","root","$root","$","$toolbar","constructor","editor","undefined","val","render","getDoc","getCurrent","doc","cursor","getCursor","codeMirrorRender","codeMirrorListen","toolbarRender","toolbarListen","CodeMirror","fromTextArea","lineNumbers","theme","mode","addClass","on","cm","change","prevStr","getLine","from","line","event","keyCode","reg","test","flag","match","parseInt","replaceRange","text","join","includes","value","setCursor","ch","html","input","document","createElement","$input","attr","type","one","target","files","request","result","upload","code","image","url","length","focus","trigger","showdown","Converter","makeHtml","getValue","previewRender","memo","tmpl","$target","find","remove","ready"],"version":3,"file":"write.c783b054.js.map"}